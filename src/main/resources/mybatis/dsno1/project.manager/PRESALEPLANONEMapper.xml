<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.yy.mapper.dsno1.project.manager.PRESALEPLANONEMapper">
	
	<!--表名 -->
	<sql id="tableName">
		DT_PRESALEPLANONE
	</sql>
	
	<!--数据字典表名 -->
	<sql id="dicTableName">
		SYS_DICTIONARIES
	</sql>
	
	<!-- 字段 -->
	<sql id="Field">
		f.FNUMBER,	
		f.FDESCRIPTION,	
		f.FSORT,	
		f.FCREATETIME,	
		f.FFOUNDER,	
		f.FFOUNDERACCOUNT,	
		f.FMODIFIERS,	
		f.FMODIFIERSACCOUNT,	
		f.FMODIFIERSTIME,	
		f.FCABINETTYPE,	
		f.FRESERVE2,	
		f.FRESERVE3,	
		f.FRESERVE4,	
		f.FRESERVE5,	
		f.PRESALEPLAN_ID,	
		f.PRESALEPLANONE_ID
	</sql>
	
	<!-- 字段用于新增 -->
	<sql id="Field2">
		FNUMBER,	
		FDESCRIPTION,	
		FSORT,	
		FCREATETIME,	
		FFOUNDER,	
		FFOUNDERACCOUNT,	
		FMODIFIERS,	
		FMODIFIERSACCOUNT,	
		FMODIFIERSTIME,	
		FCABINETTYPE,	
		FRESERVE2,	
		FRESERVE3,	
		FRESERVE4,	
		FRESERVE5,	
		PRESALEPLAN_ID,	
		PRESALEPLANONE_ID
	</sql>
	
	<!-- 字段值 -->
	<sql id="FieldValue">
		#{FNUMBER},	
		#{FDESCRIPTION},	
		#{FSORT},	
		#{FCREATETIME},	
		#{FFOUNDER},	
		#{FFOUNDERACCOUNT},	
		#{FMODIFIERS},	
		#{FMODIFIERSACCOUNT},	
		#{FMODIFIERSTIME},	
		#{FCABINETTYPE},	
		#{FRESERVE2},	
		#{FRESERVE3},	
		#{FRESERVE4},	
		#{FRESERVE5},	
		#{PRESALEPLAN_ID},	
		#{PRESALEPLANONE_ID}
	</sql>
	
	<!-- 新增-->
	<insert id="save" parameterType="pd">
		insert into 
	<include refid="tableName"></include>
		(
	<include refid="Field2"></include>
		) values (
	<include refid="FieldValue"></include>
		)
	</insert>
	
	<!-- 删除-->
	<delete id="delete" parameterType="pd">
		delete from
		<include refid="tableName"></include>
		where 
			PRESALEPLANONE_ID = #{PRESALEPLANONE_ID}
	</delete>
	
	<!-- 修改 -->
	<update id="edit" parameterType="pd">
		update
		<include refid="tableName"></include>
		set 
			FNUMBER = #{FNUMBER},
			FDESCRIPTION = #{FDESCRIPTION},
			FSORT = #{FSORT},
			FCREATETIME = #{FCREATETIME},
			FFOUNDER = #{FFOUNDER},
			FFOUNDERACCOUNT = #{FFOUNDERACCOUNT},
			FMODIFIERS = #{FMODIFIERS},
			FMODIFIERSACCOUNT = #{FMODIFIERSACCOUNT},
			FMODIFIERSTIME = #{FMODIFIERSTIME},
			FCABINETTYPE = #{FCABINETTYPE},
			FRESERVE2 = #{FRESERVE2},
			FRESERVE3 = #{FRESERVE3},
			FRESERVE4 = #{FRESERVE4},
			FRESERVE5 = #{FRESERVE5},
			PRESALEPLAN_ID = #{PRESALEPLAN_ID},
			PRESALEPLANONE_ID = PRESALEPLANONE_ID
		where 
			PRESALEPLANONE_ID = #{PRESALEPLANONE_ID}
	</update>
	
	<!-- 通过ID获取数据 -->
	<select id="findById" parameterType="pd" resultType="pd">
		select 
		<include refid="Field"></include>
		from 
		<include refid="tableName"></include> f
		where 
			f.PRESALEPLANONE_ID = #{PRESALEPLANONE_ID}
	</select>
	
	<!-- 列表 -->
	<select id="datalistPage" parameterType="page" resultType="pd">
		select
		<include refid="Field"></include>
		from 
		<include refid="tableName"></include> f
		where 1=1 AND PRESALEPLAN_ID = #{pd.PRESALEPLAN_ID}
		<if test="pd.KEYWORDS != null and pd.KEYWORDS != ''"><!-- 关键词检索 -->
			and
				(
				<!--	根据需求自己加检索条件
					字段1 LIKE '%'+ #{pd.KEYWORDS}+'%'
					 or 
					字段2 LIKE '%'+ #{pd.KEYWORDS}+'%' 
				-->
				)
		</if>
		[fhstart]ORDER BY CAST(FNUMBER AS NUMERIC(32,4))[fhend]
	</select>
	
	<!-- 列表(全部) -->
	<select id="listAll" parameterType="pd" resultType="pd">
		select
		<include refid="Field"></include>
		from 
		<include refid="tableName"></include> f
	</select>
	
	<!-- 批量删除 -->
	<delete id="deleteAll" parameterType="String">
		delete from
		<include refid="tableName"></include>
		where 
			PRESALEPLANONE_ID in
		<foreach item="item" index="index" collection="array" open="(" separator="," close=")">
                 #{item}
		</foreach>
	</delete>
	
	<!-- 最大序号+1 -->
	<select id="maxNum" parameterType="pd" resultType="pd">
		SELECT
		ISNULL(MAX(CAST(ISNULL(FNUMBER,0) AS INT)),0)+1 maxNum
		FROM 
		<include refid="tableName"></include> f
		WHERE 
		PRESALEPLAN_ID = #{PRESALEPLAN_ID}
	</select>
	
	<!-- 删除已读-->
	<delete id="deleteFBOne" parameterType="pd">
		delete from
		<include refid="tableName"></include>
		where 
			PRESALEPLAN_ID = #{PRESALEPLAN_ID}
	</delete>
	
	<!-- 依据售前方案ID查询一级明细柜体类型汇总信息 -->
	<select id="getCabinByType" parameterType="pd" resultType="pd">
		SELECT
		f.NUM,
		f.FCABINETTYPE,
		ISNULL(f1.Buffer_Period,'0') Buffer_Period
		FROM
			(
				SELECT 
				COUNT(*) NUM,
				FCABINETTYPE 
				FROM 
				DT_PRESALEPLANONE 
				WHERE 
				PRESALEPLAN_ID = #{PRESALEPLAN_ID} 
				AND FCABINETTYPE != '' 
				AND FCABINETTYPE IS NOT NULL
				GROUP BY FCABINETTYPE
			) f 
		LEFT JOIN PMS_Cabinet_Type f1 ON f.FCABINETTYPE = f1.Cabinet_Type_Name
	</select>
	
	<!-- 依据售前方案ID查询一级明细柜体信息 -->
	<select id="getCabin" parameterType="pd" resultType="pd">
		SELECT 
		f.PRESALEPLANONE_ID,
		f.FDESCRIPTION,
		f1.Cabinet_Type_Name 
		FROM DT_PRESALEPLANONE f
		LEFT JOIN 
		PMS_Cabinet_Type f1 ON f.FCABINETTYPE = f1.Cabinet_Type_Name
		WHERE 
		f.PRESALEPLAN_ID = #{PRESALEPLAN_ID} 
		AND f1.Cabinet_Type_Name IS NOT NULL 
		AND f1.Cabinet_Type_Name != ''
	</select>
	<!-- yy356703572qq(彬耶) -->
</mapper>